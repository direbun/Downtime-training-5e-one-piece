<div class="dt-training">
  <div class="dt-header">
    <button type="button" class="dt-btn" data-action="dt-train">
      Train (Downtime)
    </button>
    {{#if isGM}}
      <button type="button" class="dt-btn dt-danger" data-action="dt-reset">
        Reset Progress (GM)
      </button>
    {{/if}}
  </div>

  <h3>Ability Score Training</h3>
  <table class="dt-table">
    <thead>
      <tr>
        <th>Ability</th>
        <th>Score</th>
        <th>Progress</th>
        <th>Target</th>
      </tr>
    </thead>
    <tbody>
      {{#each abilities}}
        <tr>
          <td>{{label}}</td>
          <td>{{score}}</td>
          {{#if capped}}
            <td colspan="2"><span class="dt-pill">CAP 30</span></td>
          {{else}}
            <td>{{progress}} / {{needed}}</td>
            <td>DC {{dc}}</td>
          {{/if}}
        </tr>
      {{/each}}
    </tbody>
  </table>

  <h3>Endurance (+1 HP per Level)</h3>
  <p>
    Ranks: <b>{{endurance.ranks}}</b> —
    Progress: <b>{{endurance.successes}} / {{endurance.needed}}</b> —
    DC <b>{{endurance.dc}}</b>
  </p>
  <p class="dt-muted">Sheet Bonus HP per Level: <b>{{endurance.hpBonusPerLevel}}</b></p>

  <h3>Resistance / Immunity</h3>
  <p>Resistances ({{resilience.resistsCount}}): <span class="dt-muted">{{resilience.resistsList}}</span></p>
  <p>Immunities ({{resilience.immunesCount}}): <span class="dt-muted">{{resilience.immunesList}}</span></p>
  <p>Resilience Rank: <b>{{resilience.rank}}</b></p>
  <p><b>New Resistance:</b> {{resilience.newSuccesses}} / {{resilience.newNeeded}} (DC {{resilience.newDc}})</p>

  {{#if resilience.refines.length}}
    <p class="dt-small">Refine need <b>{{resilience.refineNeeded}}</b> successes (per type), DC <b>{{resilience.refineDc}}</b></p>
    <table class="dt-table">
      <thead>
        <tr><th>Type</th><th>Progress</th></tr>
      </thead>
      <tbody>
        {{#each resilience.refines}}
          <tr>
            <td>{{label}}</td>
            <td>{{successes}} / {{../resilience.refineNeeded}}</td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  {{else}}
    <p class="dt-muted">No ongoing refinement projects.</p>
  {{/if}}

  <h3>Haki / Devil Fruit</h3>
  <table class="dt-table">
    <thead>
      <tr>
        <th>Track</th>
        <th>Rank</th>
        <th>Progress</th>
        <th>Target</th>
      </tr>
    </thead>
    <tbody>
      {{#each haki.tracks}}
        <tr>
          <td>{{label}}</td>
          <td>{{rank}}</td>
          <td>{{successes}} / {{needed}}</td>
          <td>DC {{dc}}</td>
        </tr>
      {{/each}}
    </tbody>
  </table>

  {{#if haki.fruit.name}}
    <p style="margin-top:8px;"><b>Devil Fruit:</b> {{haki.fruit.name}}</p>
    <p class="dt-muted">Ability: <b>{{haki.fruit.abilityLabel}}</b>, Skill: <b>{{haki.fruit.skill}}</b></p>
    <p>Rank: <b>{{haki.fruit.rank}}</b> — Progress: <b>{{haki.fruit.successes}} / {{haki.fruit.needed}}</b> — DC <b>{{haki.fruit.dc}}</b></p>
  {{else}}
    <p class="dt-muted">No Devil Fruit locked on this actor (or not yet set).</p>
  {{/if}}
</div>
